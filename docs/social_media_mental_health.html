<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Effect of Social Media Reduction on Depression and Anxiety: A Meta-Analysis of RCTs – Matthew B. Jané</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href=".//webLogoFavicon2.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="The Effect of Social Media Reduction on Depression and Anxiety: A Meta-Analysis of RCTs – Matthew B. Jané">
<meta property="og:description" content="This site contains the most up to date database on RCTs of effects of social media’s effect on depression and anxiety. Contributors: Minnea Rutar and Sabrina Norwood.">
<meta property="og:image" content="https://matthewbjane.com/webLogo2.png">
<meta property="og:site_name" content="Matthew B. Jané">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="4780">
<meta property="og:image:width" content="5906">
<meta name="twitter:title" content="The Effect of Social Media Reduction on Depression and Anxiety: A Meta-Analysis of RCTs – Matthew B. Jané">
<meta name="twitter:description" content="This site contains the most up to date database on RCTs of effects of social media’s effect on depression and anxiety. Contributors: Minnea Rutar and Sabrina Norwood.">
<meta name="twitter:image" content="https://matthewbjane.com/webLogo2.png">
<meta name="twitter:creator" content="@MatthewBJane">
<meta name="twitter:image-height" content="4780">
<meta name="twitter:image-width" content="5906">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./webLogoFavicon2.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Matthew B. Jané</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./blog.html"> 
<span class="menu-text">Meta-Analysis Magic</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./CV.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Books.html"> 
<span class="menu-text">Books</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Consulting.html"> 
<span class="menu-text">Consulting</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./social_media_mental_health.html" aria-current="page"> 
<span class="menu-text">SM &amp; MH Living Meta-Analysis</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.github.com/MatthewBJane"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.twitter.com/MatthewBJane"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="./blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#design-of-the-studies" id="toc-design-of-the-studies" class="nav-link active" data-scroll-target="#design-of-the-studies">Design of the studies</a></li>
  <li><a href="#search" id="toc-search" class="nav-link" data-scroll-target="#search">Search</a></li>
  <li><a href="#effect-size-calculation" id="toc-effect-size-calculation" class="nav-link" data-scroll-target="#effect-size-calculation">Effect size calculation</a></li>
  <li><a href="#handling-dependency" id="toc-handling-dependency" class="nav-link" data-scroll-target="#handling-dependency">Handling Dependency</a></li>
  <li><a href="#data-extraction-of-missing-information" id="toc-data-extraction-of-missing-information" class="nav-link" data-scroll-target="#data-extraction-of-missing-information">Data extraction of missing information</a></li>
  <li><a href="#analysis-and-results" id="toc-analysis-and-results" class="nav-link" data-scroll-target="#analysis-and-results">Analysis and Results</a></li>
  <li><a href="#modeling-length-of-intervention" id="toc-modeling-length-of-intervention" class="nav-link" data-scroll-target="#modeling-length-of-intervention">Modeling Length of Intervention</a>
  <ul class="collapse">
  <li><a href="#model-results" id="toc-model-results" class="nav-link" data-scroll-target="#model-results">Model Results</a></li>
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics">Diagnostics</a></li>
  </ul></li>
  <li><a href="#anxiety-vs-depression" id="toc-anxiety-vs-depression" class="nav-link" data-scroll-target="#anxiety-vs-depression">Anxiety vs Depression</a></li>
  <li><a href="#session-info" id="toc-session-info" class="nav-link" data-scroll-target="#session-info">Session Info</a></li>
  <li><a href="#citing-r-packages" id="toc-citing-r-packages" class="nav-link" data-scroll-target="#citing-r-packages">Citing R packages</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Effect of Social Media Reduction on Depression and Anxiety: A Meta-Analysis of RCTs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    This site contains the most up to date database on RCTs of effects of social media’s effect on depression and anxiety.<br><br> <strong>Contributors: Minnea Rutar and Sabrina Norwood.</strong><br>
  </div>
</div>


</header>


<section id="design-of-the-studies" class="level2">
<h2 class="anchored" data-anchor-id="design-of-the-studies">Design of the studies</h2>
<p>The studies included in this meta-analysis are RCTs which randomize participants into two (or more) arms. Typically in these studies, there are two arms: 1) a social media reduction intervention and 2) a control (i.e., using social media as usual). The period of the reduction will vary between studies (usually around 1-4). This meta-analysis extracts pre and post-test effects and any mid-intervention effects. The timeline for a typical intervention is as follows:</p>
<p><span class="math display">\[
\textrm{pre-test (Week 0)} \rightarrow \textrm{mid-test (0&lt;Week&lt;N)}\rightarrow \,...\,\rightarrow \textrm{post-test (Week N)}
\]</span></p>
<p>Outcomes of interest are measures of depression (e.g., BDI) and/or anxiety (e.g., GAD).</p>
</section>
<section id="search" class="level2">
<h2 class="anchored" data-anchor-id="search">Search</h2>
<p>Current search is just from the studies collected by in <a href="https://psycnet.apa.org/record/2024-80192-001">this meta-analysis</a> by Christopher Ferguson. New studies or study data can be submitted to me at matthewbjane@gmail.com.</p>
</section>
<section id="effect-size-calculation" class="level2">
<h2 class="anchored" data-anchor-id="effect-size-calculation">Effect size calculation</h2>
<p>Effect sizes are calculated using the method described in <a href="https://journals.sagepub.com/doi/abs/10.1177/1094428106291059?casa_token=KhGJ14Quu6UAAAAA:0MlMLw5---MEtZyzC2CWkuZDkz9ZQbPPaQfJk2HiKxl03QGCxovi2oE7QnMPkoCu_gucadcRL3OBtw&amp;casa_token=COAuI7Jj7FwAAAAA:sECB4k6SouyGyNZLbQHK3ciSIsUw-Ok-o4ryf4NtP9axyOuTNwnW2JHlELETAGu58fTC2e_0KbHB7Q">a paper</a> by Scott B. Morris on pre-post-control effects. Particularly, we want to take the reduction-control difference in the pre-post <em>change</em>. Each study will have a pre-test mean for the control group <span class="math inline">\(\mu^C_0\)</span> and the reduction group <span class="math inline">\(\mu^R_0\)</span> as well as a post-test mean: <span class="math inline">\(\mu^C_1\)</span> and <span class="math inline">\(\mu^R_1\)</span>. Therefore the change between pre and post is <span class="math inline">\(\mu_1 - \mu_0\)</span>. To account for different scales across studies, the we will standardize the difference in the mean change between reduction and control groups by the within-group pre-test standard deviation <span class="math inline">\(\sigma_0\)</span>,</p>
<p><span id="eq-pop-smd"><span class="math display">\[
\delta = \frac{(\mu^R_1 - \mu^R_0) - (\mu^C_1 - \mu^C_0)}{\sigma_0},
\tag{1}\]</span></span></p>
<p>and thus <span class="math inline">\(\delta\)</span> is our effect size of interest. This formulation of the standardized mean difference (SMD) has a lot of nice properties, most notably,</p>
<ol type="1">
<li><p>In RCTs pre-test standard deviations should be <em>in expectation</em> the same, and therefore the assumption of equal variance between arms should be met in most cases. Note here that we use complete cases (only subjects that underwent the intervention), so attrition effects could potentially violate this assumption (violations in this assumption probably have to be severe to make much of a difference).</p></li>
<li><p>Controlling for baseline. As I mentioned in the first point, attrition effects may cause differences in baseline means between groups even if it is an RCT. To hopefully account for some types of attrition effects, we subtract the baseline mean (i.e., pre-test mean) from the post-test mean within the reduction and control groups.</p></li>
</ol>
<p>In each study sample, we have to extract and calculate sample estimates of the SMD. Our formula for a sample estimate of <span class="math inline">\(\delta\)</span> can be expressed as,</p>
<p><span id="eq-sam-smd"><span class="math display">\[
d = \frac{(m^R_1 - m^R_0) - (m^C_1 - m^C_0)}{s_0} \times c(\nu),
\tag{2}\]</span></span> where <span class="math inline">\(c(\nu) = \sqrt{2/\nu}\times\left(\Gamma[\nu/2]/\Gamma[(\nu-1)/2]\right)\)</span> is Hedges’ small sample correction factor and <span class="math inline">\(\nu\)</span> is the degrees of freedom <span class="math inline">\(\nu = n_R+n_C -2\)</span>. Since we have two samples of the pre-test standard deviation, we have to obtain <span class="math inline">\(s_0\)</span> by pooling the reduction and control group’s variances,</p>
<p><span class="math display">\[
s_0 = \sqrt{\frac{(n_R-1)\left(s^R_0\right)^2 + (n_C-1)\left(s^C_0\right)^2}{n_R + n_C - 2}}
\]</span></p>
<p>To obtain the precision of the of the estimate we can use</p>
</section>
<section id="handling-dependency" class="level2">
<h2 class="anchored" data-anchor-id="handling-dependency">Handling Dependency</h2>
<p>There are two sources of sample dependency in this analysis: multiple outcomes (i.e., anxiety/depression) and multiple time-points (e.g., week 1 and week 2). Two handle this problem we will use robust variance estimation to account for time dependency and</p>
</section>
<section id="data-extraction-of-missing-information" class="level2">
<h2 class="anchored" data-anchor-id="data-extraction-of-missing-information">Data extraction of missing information</h2>
<ul>
<li>When data can not be extracted from the primary article, the corresponding author is contacted.</li>
<li>When pre-test information is unavailable (e.g., they were never assessed at baseline) then we assume that the baseline scores are equal between groups (<span class="math inline">\(\mu_0 = \mu^R_0 = \mu^C_0\)</span>) which reduces the numerator of <a href="#eq-pop-smd" class="quarto-xref">Equation&nbsp;1</a> to be <span class="math inline">\((\mu^R_1 - \mu^R_0) - (\mu^C_1 - \mu^C_0) = \mu^R_1 - \mu_0 - \mu^C_1 + \mu_0 = \mu^R_1 - \mu^C_1\)</span>. The denominator will be the post-test standard deviation and therefore we will assume that the post-test standard deviation is equal to the pre-test standard deviation.</li>
<li>When necessary statistical information isn’t reported directly, alternative statistics are used to triangulate to the needed statistics (either via simulation or analytically).</li>
</ul>
</section>
<section id="analysis-and-results" class="level2">
<h2 class="anchored" data-anchor-id="analysis-and-results">Analysis and Results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">buildtools.check =</span> <span class="cf">function</span>(action) <span class="cn">TRUE</span> )</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metafor)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clubSandwich)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"social_media_data.csv"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># assume .80 pre-post correlation</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> .<span class="dv">80</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_raw =</span> ((reduction_mean_post<span class="sc">-</span> reduction_mean_pre) <span class="sc">-</span> (control_mean_post <span class="sc">-</span> control_mean_pre)) <span class="sc">/</span> <span class="fu">sqrt</span>( ( (reduction_n <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>(reduction_sd_pre<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (control_n <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>(control_sd_pre<span class="sc">^</span><span class="dv">2</span>) ) <span class="sc">/</span> (reduction_n <span class="sc">+</span> control_n <span class="sc">-</span> <span class="dv">2</span>) ),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">nu =</span> control_n<span class="sc">+</span>reduction_n<span class="dv">-2</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">c_factor =</span> <span class="fu">ifelse</span>(<span class="fu">gamma</span>(nu<span class="sc">/</span><span class="dv">2</span>)<span class="sc">==</span> <span class="cn">Inf</span>,<span class="dv">1</span>,<span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">/</span>nu)<span class="sc">*</span><span class="fu">gamma</span>(nu<span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">gamma</span>((nu<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span>)),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> d_raw <span class="sc">*</span> c_factor,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">v =</span> (<span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>( (reduction_n<span class="sc">*</span>r<span class="sc">+</span>control_n<span class="sc">*</span>r)<span class="sc">/</span>(reduction_n <span class="sc">+</span> control_n))) <span class="sc">*</span> ((reduction_n<span class="sc">+</span>control_n)<span class="sc">/</span>(reduction_n<span class="sc">*</span>control_n)) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (d<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> ((reduction_n<span class="sc">*</span>r<span class="sc">+</span>control_n<span class="sc">*</span>r)<span class="sc">/</span>(reduction_n<span class="sc">+</span>control_n))) <span class="sc">*</span> ((reduction_n<span class="sc">+</span>control_n)<span class="sc">/</span>(reduction_n<span class="sc">*</span>control_n))))) <span class="sc">-</span> d<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span> c_factor<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">sei =</span> <span class="fu">sqrt</span>(v))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modeling-length-of-intervention" class="level2">
<h2 class="anchored" data-anchor-id="modeling-length-of-intervention">Modeling Length of Intervention</h2>
<p>The model below fits a regresses the SMD on length of the intervention (in weeks) using a Generalized Additive Model (GAM). Essentially, we model the observed effects <span class="math inline">\(d_{i_e}\)</span>, where a non-linear function <span class="math inline">\(f\)</span> of <span class="math inline">\(W_{i_e}\)</span> (length of the intervention in weeks) captures the conditional mean of true effects <span class="math inline">\(f(W_{i_e}) = \mathbb{E}[\delta_{i_e}\,|\,W_{i_e}]\)</span>. The estimated the model can be expressed as</p>
<p><span class="math display">\[
d_{i_e}\, |\, W_{i_e} \sim \mathcal{N}\left(f(W_{i_e}), \Sigma\right)
\]</span></p>
<p>The covariance matrix <span class="math inline">\(\Sigma\)</span> has non-zero off-diagonal elements when effects are from the same sample (<span class="math inline">\(d_{i_1}...d_{i_q}\)</span>) which accounts for sample dependency. The assumption here is that within-sample effects are homogenous <em>after</em> conditioning on the length of the intervention (<span class="math inline">\(W_{i_e}\)</span>). Important to note that this implies that depression and anxiety effects are homogenous within-studies, but we will differentiate these in the next section.</p>
<p>In R, we can use the <code>brms</code> <span class="citation" data-cites="brms">[@brms]</span> and <code>mgcv</code> <span class="citation" data-cites="mgcv">[@mgcv]</span> packages to fit a Bayesian meta-analytic GAM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">default_prior</span>(d<span class="sc">|</span><span class="fu">se</span>(sei) <span class="sc">~</span> <span class="fu">s</span>(weeks, <span class="at">k=</span><span class="dv">2</span>) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>sample_id),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> dat, <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>prior<span class="sc">$</span>prior[[<span class="fu">which</span>(prior<span class="sc">$</span>class<span class="sc">==</span><span class="st">"Intercept"</span>)]] <span class="ot">&lt;-</span> <span class="st">"normal(0,1)"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">brm</span>(d<span class="sc">|</span><span class="fu">se</span>(sei) <span class="sc">~</span> <span class="fu">s</span>(weeks, <span class="at">k =</span> <span class="dv">2</span>) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> sample_id),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> dat,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">prior =</span> prior,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">sample_prior =</span> <span class="st">"yes"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">file =</span> <span class="st">"average_model"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">warmup =</span> <span class="dv">200</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">control =</span> <span class="fu">list</span>(<span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">file_refit =</span> <span class="st">"on_change"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="model-results" class="level3">
<h3 class="anchored" data-anchor-id="model-results">Model Results</h3>
<p>We can visualize the model results by plotting out the posterior draws over time. The vertical axis denotes the SMD where a positive value means more depression/anxiety in the reduction group (i.e., treatment is detrimental) whereas a negative value denotes a reduction in anxiety/depression in the reduction group (i.e., treatment is beneficial). The horizontal axis is the length of the intervention, or rather, the amount of time social media has been reduced for.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="social_media_mental_health_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="2450"></p>
<figcaption>Lines denote estimated conditional means from 200 posterior draws. The shaded interval denotes the 90% prediction interval (the interval where 90% of true effects fall).</figcaption>
</figure>
</div>
</div>
</div>
<p>We see a very subtle trend toward zero after an initial benefit at 1-2 weeks. Let us look at the average effect size estimates at each week (weeks 1,2,3,4).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="social_media_mental_health_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There seems to not be good evidence that withdrawal effects are present (week 1 does not show substantially lower effects than other weeks) or that there is any substantial increase in the effect at a given week. Week 4 appears to have the lowest average effect at <span class="math inline">\(\bar{\delta}\)</span> = -0.15.</p>
</section>
<section id="diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="diagnostics">Diagnostics</h3>
<p>The posterior predictive check is just <em>okay</em>, it seems that the model predicts a little more variability in the effect sizes than what is observed. This <em>may</em> mean that the pre/post correlations are under-estimated thus making the variability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(mdl,<span class="at">ndraws=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="social_media_mental_health_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="anxiety-vs-depression" class="level2">
<h2 class="anchored" data-anchor-id="anxiety-vs-depression">Anxiety vs Depression</h2>
<p>We can make a slightly more complex model that looks at the interaction of the temporal trend and the construct (anxiety and depression). When running the interaction model with the following formulation, the model did not converge (R hat value was &gt;2.8 for all the interaction terms) and is likely far too complex to model with this small of a data set. Instead I just included the main effect of construct without the product term and the model thankfully converged. The model of the multiple regression with the main effects for <code>s(weeks)</code> and <code>construct</code> is shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">default_prior</span>(d<span class="sc">|</span><span class="fu">se</span>(sei) <span class="sc">~</span> <span class="fu">s</span>(weeks, <span class="at">k=</span><span class="dv">2</span>) <span class="sc">+</span> construct <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>sample_id),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> dat, <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>prior<span class="sc">$</span>prior[[<span class="fu">which</span>(prior<span class="sc">$</span>class<span class="sc">==</span><span class="st">"Intercept"</span>)]] <span class="ot">&lt;-</span> <span class="st">"normal(0,1)"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>mdl_construct <span class="ot">&lt;-</span> <span class="fu">brm</span>(d<span class="sc">|</span><span class="fu">se</span>(sei) <span class="sc">~</span> <span class="fu">s</span>(weeks, <span class="at">k=</span><span class="dv">2</span>) <span class="sc">+</span> construct <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> sample_id),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> dat,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">prior =</span> prior,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">sample_prior =</span> <span class="st">"yes"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">warmup =</span> <span class="dv">200</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">file =</span> <span class="st">"construct_model"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">control =</span> <span class="fu">list</span>(<span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">file_refit =</span> <span class="st">"on_change"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="social_media_mental_health_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="2450"></p>
<figcaption>Lines denote estimated conditional means from 500 posterior draws.</figcaption>
</figure>
</div>
</div>
</div>
<p>We can see we see very similar trends for both the depression and anxiety plots. Similar to the overall mental health model, here we will plot out the week by week estimates of the average effect separated by anxiety (in red) and depression (in blue).</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="social_media_mental_health_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Anyways, those are the results for now, the data and code are all publicly available in my <a href="https://github.com/MatthewBJane/MatthewBJane.github.io">MatthewBJane.github.io</a> repository.</p>
</section>
<section id="session-info" class="level2">
<h2 class="anchored" data-anchor-id="session-info">Session Info</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.0 (2024-04-24)
Platform: aarch64-apple-darwin20
Running under: macOS Sonoma 14.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/New_York
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] ggdist_3.3.2        modelr_0.1.11       tidybayes_3.0.7    
 [4] mgcv_1.9-1          nlme_3.1-164        clubSandwich_0.5.11
 [7] lubridate_1.9.3     forcats_1.0.0       stringr_1.5.1      
[10] dplyr_1.1.4         purrr_1.0.2         readr_2.1.5        
[13] tidyr_1.3.1         tibble_3.2.1        ggplot2_3.5.1      
[16] tidyverse_2.0.0     brms_2.22.0         Rcpp_1.0.12        
[19] metafor_4.6-0       numDeriv_2016.8-1.1 metadat_1.2-0      
[22] Matrix_1.7-0       

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1     svUnit_1.0.6         viridisLite_0.4.2   
 [4] farver_2.1.2         loo_2.8.0            fastmap_1.2.0       
 [7] tensorA_0.36.2.1     mathjaxr_1.6-0       digest_0.6.36       
[10] timechange_0.3.0     lifecycle_1.0.4      StanHeaders_2.32.10 
[13] magrittr_2.0.3       posterior_1.6.0      compiler_4.4.0      
[16] rlang_1.1.4          tools_4.4.0          utf8_1.2.4          
[19] yaml_2.3.8           knitr_1.47           labeling_0.4.3      
[22] bridgesampling_1.1-2 htmlwidgets_1.6.4    pkgbuild_1.4.4      
[25] plyr_1.8.9           abind_1.4-8          tinytable_0.5.0     
[28] withr_3.0.0          grid_4.4.0           stats4_4.4.0        
[31] fansi_1.0.6          colorspace_2.1-0     inline_0.3.19       
[34] scales_1.3.0         cli_3.6.3            mvtnorm_1.3-1       
[37] rmarkdown_2.27       generics_0.1.3       RcppParallel_5.1.9  
[40] rstudioapi_0.16.0    reshape2_1.4.4       tzdb_0.4.0          
[43] rstan_2.32.6         splines_4.4.0        bayesplot_1.11.1    
[46] parallel_4.4.0       matrixStats_1.4.1    vctrs_0.6.5         
[49] sandwich_3.1-1       jsonlite_1.8.8       hms_1.1.3           
[52] arrayhelpers_1.1-0   glue_1.7.0           codetools_0.2-20    
[55] cowplot_1.1.3        distributional_0.4.0 stringi_1.8.4       
[58] gtable_0.3.5         QuickJSR_1.3.1       munsell_0.5.1       
[61] pillar_1.9.0         htmltools_0.5.8.1    Brobdingnag_1.2-9   
[64] R6_2.5.1             evaluate_0.24.0      lattice_0.22-6      
[67] backports_1.5.0      broom_1.0.6          renv_0.17.3         
[70] rstantools_2.4.0     coda_0.19-4.1        gridExtra_2.3       
[73] checkmate_2.3.1      xfun_0.45            zoo_1.8-12          
[76] pkgconfig_2.0.3     </code></pre>
</div>
</div>
</section>
<section id="citing-r-packages" class="level2">
<h2 class="anchored" data-anchor-id="citing-r-packages">Citing R packages</h2>
<p>The following packages were used in this post:</p>
<ul>
<li><code>brms</code> <span class="citation" data-cites="brms">[@brms]</span></li>
<li><code>mgcv</code> <span class="citation" data-cites="splines">[@splines]</span></li>
<li><code>tidyverse</code> <span class="citation" data-cites="tidyverse">[@tidyverse]</span></li>
<li><code>ggdist</code> <span class="citation" data-cites="ggdist">[@ggdist]</span></li>
<li><code>modelr</code> <span class="citation" data-cites="modelr">[@modelr]</span></li>
<li><code>tidybayes</code> <span class="citation" data-cites="tidybayes">[@tidybayes]</span></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/matthewbjane\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Email me at matthew.jane@uconn.edu</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>